{% extends 'base.html' %}

{% block head %}
<body>
    <h1>Profile Management</h1>

    <!-- Form for email update -->
    <form method="POST" action="{% url 'profile_settings' %}">
        {% csrf_token %}
        <label for="email">Email:</label>
        <input type="email" id="email" name="email" value="{{ user.email }}">


        <button type="submit" name="update_email">Update Email</button> 
    </form>

    <!-- Form for password change -->
    <form method="POST" action="{% url 'profile_settings' %}">
        {% csrf_token %}
        {{ password_form.as_p }}
        <button type="submit" name="change_password">Change Password</button> 
    </form>
    <h2>Your Listings</h2>
{% if listings %}
    <ul>
    {% for listing in listings %}
        <li>
            <p><strong>{{ listing.name }}</strong> - ${{ listing.price }}</p>
            <p>{{ listing.description }}</p>
            <img src="{{ listing.image.url }}" width="200" height="200" alt="Listing Image">
            
            <!-- Only show edit and delete buttons if the listing belongs to the logged-in user -->
            
            {% if request.user == listing.user %}

                    {% csrf_token %}
                    <button type="submit">Edit</button>
                                     
                </form>
                <form action="{% url 'delete_listing' listing.id %}" method="POST" style="display:inline;">

                    {% csrf_token %}
                    <button type="submit">Delete</button>
                                     
                </form>
            {% endif %}
        </li>
    {% endfor %}
    </ul>
{% else %}
    <p>You have no listings yet.</p>
{% endif %}

</body>
{% endblock %}